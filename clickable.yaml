clickable_minimum_required: 8.0.0
builder: cmake
kill: qmlscene

# Setup Node.js in the build container
image_setup:
  run:
    - curl -fsSL https://deb.nodesource.com/setup_16.x | bash -
    - apt-get install -y nodejs

libraries:
  bitwarden-cli:
    builder: custom
    build: |
      npm install
      npm run sub:init  
      npm run build
      mkdir -p ../lib
      cat > ../lib/bw << 'EOF'
      #!/bin/bash
      set -e
      SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
      CLI_DIR="$SCRIPT_DIR/../libs/bitwarden-cli"
      if ! command -v node >/dev/null 2>&1; then
        echo "Error: Node.js is required but not found in PATH."
        exit 1
      fi
      if [ ! -f "$CLI_DIR/build/bw.js" ]; then
        echo "Error: Bitwarden CLI build not found at $CLI_DIR/build/bw.js"
        exit 1
      fi
      exec node "$CLI_DIR/build/bw.js" "$@"
      EOF
      chmod +x ../lib/bw
